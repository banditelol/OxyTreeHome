<!-- AIzaSyDLFcEIoaS2K1rrLFItxkCNR0ElabGkkws -->
<html>
    <head>
        <title>Bootstrap & Google maps Tutorial by Bootstrapious.com</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
        <link href='https://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
        <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,300italic,400italic,700italic" rel="stylesheet" type="text/css">
        <style type="text/css" media="screen">
          #map{
            width: 100%;
            height: 400px;
          }
        </style>
    </head>
    <body>

        <div class="container">

            <div class="row">

                <div class="col-lg-8 col-lg-offset-2">

                    <h1 class="text-center">OxyTreeMap</h1>

                    <p class="lead">This is a demo of our monitoring system for OxyTree placed on the street, you can see the status of each oxytree in real-time. Click on any marker to show the status of each OxyTree (in this case only one live data is provided)</p>

                    <p>Click on the marker to show the data on the appointed place.</p>
                    
                </div>

            </div> 

        </div> 
        
        <div id="map"></div>
        <script>
        var infowindow
            function initMap() {
              var bandung = {lat: -6.891954, lng: 107.609887};
              var bandung1 = {lat: -6.892764, lng: 107.610697};
              var bandung2 = {lat: -6.894547, lng: 107.608972};
              var bandung3 = {lat: -6.893659, lng: 107.606166};
              var bandung4 = {lat: -6.892360, lng: 107.610281};
              var bandung5 = {lat: -6.896268, lng: 107.605556};
              var bandung6 = {lat: -6.890772, lng: 107.604366};
              var bandung7 = {lat: -6.892870, lng: 107.612772};
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 15,
          center: bandung
        });

        var contentString = '<div id="content">'+'<div id="siteNotice">'+'Loading...'+ '<br>' + '<i class="fa fa-spinner fa-spin fa-fw fa-3x">'+'</i>' +'</div>'+'</div>';

        infowindow = new google.maps.InfoWindow({
          content: contentString
        });

        var marker = new google.maps.Marker({
          position: bandung,
          map: map,
          title : 'Institut Teknologi Bandung'
        });
        var marker1 = new google.maps.Marker({
          position: bandung1,
          map: map,
          title : 'Institut Teknologi Bandung'
        });
        var marker2 = new google.maps.Marker({
          position: bandung2,
          map: map,
          title : 'Institut Teknologi Bandung'
        });
        var marker3 = new google.maps.Marker({
          position: bandung3,
          map: map,
          title : 'Institut Teknologi Bandung'
        });
        var marker4 = new google.maps.Marker({
          position: bandung4,
          map: map,
          title : 'Institut Teknologi Bandung'
        });
        var marker5 = new google.maps.Marker({
          position: bandung5,
          map: map,
          title : 'Institut Teknologi Bandung'
        });
        var marker6 = new google.maps.Marker({
          position: bandung6,
          map: map,
          title : 'Institut Teknologi Bandung'
        });
        var marker7 = new google.maps.Marker({
          position: bandung7,
          map: map,
          title : 'Institut Teknologi Bandung'
        });

        marker1.addListener('click', function(){
          infowindow.open(map,marker1);
          initChart();
        });
        marker2.addListener('click', function(){
          infowindow.open(map,marker2);
          initChart();
        });
        marker3.addListener('click', function(){
          infowindow.open(map,marker3);
          initChart();
        });
        marker4.addListener('click', function(){
          infowindow.open(map,marker4);
          initChart();
        });
        marker5.addListener('click', function(){
          infowindow.open(map,marker5);
          initChart();
        });
        marker6.addListener('click', function(){
          infowindow.open(map,marker6);
          initChart();
        });
        marker7.addListener('click', function(){
          infowindow.open(map,marker7);
          initChart();
        });
        marker.addListener('click', function(){
          infowindow.open(map,marker);
          initChart();
        });

            }
        </script>
        <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDLFcEIoaS2K1rrLFItxkCNR0ElabGkkws&callback=initMap"></script>
        <script src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
        <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
        <script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js'></script>
        <script type='text/javascript' src='https://www.google.com/jsapi'></script>
        <script type='text/javascript'>
          //google.charts.load('current', {'packages':['table']});
          //google.charts.setOnLoadCallback(initChart);
          // set your channel id here
          var channel_id = 181048;
          // set your channel's read api key here if necessary
          var api_key = '67ZCF1NLTR43AFYM';
          // maximum value for the gauge
          var max_gauge_value = 200;
          // name of the gauge
          var gauge_name = 'Computer Temperature';

          // global variables
          var chart, charts, data, dataPoint;

          // load the google gauge visualization
          google.load('visualization', '1', {packages:['gauge']});
          google.setOnLoadCallback(initChart);

          // display the data
          function displayData(point) {
            data.setValue(0, 0, gauge_name);
            data.setValue(0, 1, point);
            chart.draw(data, options);
          }

          // load the data
          function loadData() {
            // variable for the data point
            var pco2, pco, ptemp, pph;

            // get the data from thingspeak
            $.getJSON('https://api.thingspeak.com/channels/' + channel_id + '/feed/last.json?api_key=' + api_key, function(data) {

              // get the data point
              
              pco2 = data.field1;
              pco = data.field2;
              ptemp = data.field3;
              pph = data.field4;
              console.log('CO2 data = '+pco2 + '\%');
              console.log('CO data = '+pco + '\%');
              console.log('temperature data = '+ptemp + 'C');
              console.log('pH data = '+pph);
              
              // if there is a data point display it
              // if (p) {
              //   p = Math.round((p / max_gauge_value) * 100);
              //   displayData(p);
              // }
              var contentString = '<div id="content">'+'<div id="siteNotice">'+'<h3>'+'OxyTree-BDG01'+'</h3>' +'<table style=" ">'+'<tr>'+'<td>'+'CO2   '+'</td>'+'<td>'+'   '+ String(pco2)+' ppm'+'</td>'+'</tr>'+'<tr>'+'<td>'+'CO   '+'</td>'+'<td>'+ '   '+String(pco)+' ppm'+'</td>'+'</tr>'+'<tr>'+'<td>'+'Temperature   '+'</td>'+'<td>'+ '   '+String(ptemp)+' C'+'</td>'+'</tr>'+'<tr>'+'<td>'+'pH   '+'</td>'+'<td>'+ '   '+ String(pph)+'</td>'+'</tr>'+'</table>'+'</div>'+'</div>'+'</div>';
              infowindow.setContent(contentString);
            });
          }

          // initialize the chart
          function initChart() {

            // data = new google.visualization.DataTable();
            // data.addColumn('string', 'Label');+'<tr>'+'<td>'+'Temperature   '+'</td>'+'<td>'+ String(p)+'</td>'+'</tr>'+'<tr>'+'<td>'+'Temperature   '+'</td>'+'<td>'+ String(p)+'</td>'+'</tr>'+'<tr>'+'<td>'+'Temperature   '+'</td>'+'<td>'+ String(p)+'</td>'+'</tr>'+'<tr>'+'<td>'+'Temperature   '+'</td>'+'<td>'+ String(p)+'</td>'+'</tr>'
            // data.addColumn('number', 'Value');
            // data.addRows(1);

            // chart = new google.visualization.Gauge(document.getElementById('gauge_div'));
            // options = {width: 120, height: 120, redFrom: 90, redTo: 100, yellowFrom:75, yellowTo: 90, minorTicks: 5};

            loadData();

            // load new data every 5 seconds
            setInterval('loadData()', 1000);
          }

        </script>
    </body>
</html>